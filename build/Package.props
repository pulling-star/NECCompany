<Project>

  <PropertyGroup>
    <MSBuildAllProjects>$(MSBuildAllProjects);$(MSBuildThisFileFullPath)</MSBuildAllProjects>
  </PropertyGroup>

  <PropertyGroup>
    <LatestRelease>18.4.0-preview2</LatestRelease>
  </PropertyGroup>

  <PropertyGroup>
    <LatestReleaseMajorMinor>$([System.Text.RegularExpressions.Regex]::Replace($(LatestRelease), '^(\d+\.\d+)\.(\d+).*$', '$1'))</LatestReleaseMajorMinor>
    <LatestReleasePatch>$([System.Text.RegularExpressions.Regex]::Replace($(LatestRelease), '^(\d+\.\d+)\.(\d+).*$', '$2'))</LatestReleasePatch>
    <CurrentReleaseMajorMinor>$([System.DateTime]::UtcNow.ToString(y.M))</CurrentReleaseMajorMinor>
    <CurrentReleasePatch>0</CurrentReleasePatch>
  </PropertyGroup>

  <PropertyGroup Condition="'$(CurrentReleaseMajorMinor)' == '$(LatestReleaseMajorMinor)'">
    <CurrentReleasePatch Condition="$(LatestRelease.Contains('-'))">$(LatestReleasePatch)</CurrentReleasePatch>
    <CurrentReleasePatch Condition="!$(LatestRelease.Contains('-'))">$([MSBuild]::Add($(LatestReleasePatch), 1))</CurrentReleasePatch>
  </PropertyGroup>

  <PropertyGroup Condition="'$(APPVEYOR)' == 'true'">
    <GitBranch>$([System.Text.RegularExpressions.Regex]::Replace($(APPVEYOR_REPO_BRANCH), '[^0-9A-Za-z]', '-'))</GitBranch>
    <GitPullRequest>$(APPVEYOR_PULL_REQUEST_NUMBER)</GitPullRequest>
    <GitTag>$(APPVEYOR_REPO_TAG_NAME)</GitTag>
  </PropertyGroup>

  <PropertyGroup Condition="'$(CIRCLECI)' == 'true'">
    <GitBranch>$([System.Text.RegularExpressions.Regex]::Replace($(CIRCLE_BRANCH), '[^0-9A-Za-z]', '-'))</GitBranch>
    <GitPullRequest>$(CIRCLE_PR_NUMBER)</GitPullRequest>
    <GitTag>$(CIRCLE_TAG)</GitTag>
  </PropertyGroup>

  <PropertyGroup>
    <IsPackable Condition="'$(GitBranch)' != '' and '$(GitBranch)' != 'master'">false</IsPackable>
    <IsPackable Condition="'$(GitPullRequest)' != ''">false</IsPackable>
    <Version Condition="'$(Version)' == ''">$(GitTag)</Version>
    <Version Condition="'$(Version)' == ''">$(CurrentReleaseMajorMinor).$(CurrentReleasePatch)-alpha-$([System.DateTime]::UtcNow.ToString(ddHHmm))</Version>
    <Authors>Klaus Hartke</Authors>
    <Copyright>&#169; $([System.DateTime]::UtcNow.ToString(yyyy)) Klaus Hartke</Copyright>
    <PackageRequireLicenseAcceptance>True</PackageRequireLicenseAcceptance>
    <PackageReleaseNotes>https://nsec.rocks/releases</PackageReleaseNotes>
    <PackageLicenseUrl>https://nsec.rocks/license</PackageLicenseUrl>
    <PackageProjectUrl>https://nsec.rocks/</PackageProjectUrl>
    <PackageIconUrl>https://nsec.rocks/nsec.png</PackageIconUrl>
    <MinClientVersion>4.0</MinClientVersion>
  </PropertyGroup>

  <ItemGroup>
    <Content Include="$(MSBuildThisFileDirectory)..\LICENSE" PackagePath="" Visible="false" />
    <Content Include="$(MSBuildThisFileDirectory)..\NOTICE" PackagePath="" Visible="false" />
  </ItemGroup>

</Project>